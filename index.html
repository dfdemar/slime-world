<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Slimeworld Evolution Simulator</title>
    <link rel="stylesheet" href="src/css/main.css">
</head>
<body>
<header>
    <h1>Slimeworld Evolution Simulator</h1>
    <span class="pill">v2.3 ‚Ä¢ patterns + live inspector</span>
    <span id="status" class="small"></span>
    <div style="margin-left:auto; display:flex; gap:8px; align-items:center;">
        <button id="btnPause">‚è∏Ô∏è Pause</button>
        <button id="btnStep" title="Step one tick (Space)">Step</button>
        <button id="btnReset">Reset</button>
        <button id="btnScreenshot" title="Save PNG">üì∏ PNG</button>
        <button id="btnExport" title="Export JSON save">üíæ Save</button>
        <input id="fileImport" type="file" accept="application/json" style="display:none" />
        <button id="btnImport" title="Load JSON save">üìÇ Load</button>
    </div>
</header>

<div id="left">
    <div class="panel" id="ecoPanel">
        <h2>Simulation</h2>
        <div class="row"><label>Seed <span class="small">(deterministic)</span></label><input id="seed" type="number" value="1337" min="0" step="1"/></div>
        <div class="row"><label>World Size</label>
            <select id="worldSize">
                <option value="128x72">128√ó72 (fast)</option>
                <option value="160x90" selected>160√ó90</option>
                <option value="192x108">192√ó108</option>
                <option value="256x144">256√ó144 (slower)</option>
            </select>
        </div>
        <div class="row"><label>Speed</label><input id="speed" type="range" min="0.1" max="4" step="0.1" value="1.2"/></div>
        <div class="row"><label>Mutation Rate</label><input id="mutRate" type="range" min="0" max="1" step="0.01" value="0.18"/></div>
        <div class="row"><label>Carrying Capacity</label><input id="capacity" type="range" min="0.1" max="2.0" step="0.05" value="1.0"/></div>
        <div class="controls-grid">
            <label class="toggle" title="Humidity overlay"><input id="ovHumidity" type="checkbox"><span>Humidity</span></label>
            <label class="toggle" title="Light overlay"><input id="ovLight" type="checkbox"><span>Light</span></label>
            <label class="toggle" title="Nutrient overlay"><input id="ovNutrient" type="checkbox"><span>Nutrients</span></label>
            <label class="toggle" title="Water mask"><input id="ovWater" type="checkbox"><span>Water</span></label>
            <label class="toggle" title="Slime trails"><input id="ovTrail" type="checkbox"><span>Slime</span></label>
        </div>
        <div class="controls-grid">
            <button id="btnReseed">Reseed Env</button>
            <button id="btnShake">Season Pulse</button>
        </div>
        <div class="small">Hotkeys: <span class="kbd">Space</span> Step ‚Ä¢ <span class="kbd">P</span> Pause/Play ‚Ä¢ <span class="kbd">R</span> Reset ‚Ä¢ <span class="kbd">S</span> Screenshot</div>
    </div>

    <div class="panel" id="spawnPanel">
        <h2>Archetypes (spawn)</h2>
        <div class="controls-grid" id="spawnGrid">
            <button data-spawn="MAT">+ Foraging Mat</button>
            <button data-spawn="CORD">+ Cord/Creeper</button>
            <button data-spawn="TOWER">+ Tower/Canopy</button>
            <button data-spawn="FLOAT">+ Floater/Raft</button>
            <button data-spawn="EAT">+ Engulfer</button>
            <button data-spawn="SCOUT">+ Scout/Prospector</button>
        </div>
        <div class="small">Click on the map to place after pressing a + button (click again to unselect).</div>
    </div>

    <div class="panel">
        <h2>Legend</h2>
        <div class="legend" id="legend"></div>
    </div>

    <div class="panel">
        <h2>Diagnostics</h2>
        <div class="row" style="justify-content:flex-start; gap:10px; flex-wrap:wrap">
            <button id="btnTests">Run Tests</button>
        </div>
        <div id="testResults" class="small"></div>
    </div>

    <div class="panel">
        <h2>About this world</h2>
        <div class="small">Slime-mould-inspired metaheuristic growth with trail reinforcement and diffusion/evaporation pruning. Water appears as connected pools. Per-colony generated patterns make individuals visually distinct.</div>
    </div>
</div>

<div id="main">
    <canvas id="canvas"></canvas>

    <div id="overlay" class="collapsed">
        <h3 style="display:flex;align-items:center;justify-content:space-between;">Inspector <button id="btnOverlayCollapse" class="icon" title="Toggle inspector">‚ü∑</button></h3>
        <div id="inspector" class="small">Click a colony to inspect.</div>
        <canvas id="miniView" width="240" height="160"></canvas>
        <div id="rtStats" class="rtgrid"></div>
        <div id="stats" style="margin-top:8px"></div>
    </div>
</div>

<div id="alert"></div>

<!-- JavaScript Modules (order matters for dependencies) -->
<script src="src/js/utils.js"></script>
<script src="src/js/archetypes.js"></script>
<script src="src/js/world.js"></script>
<script src="src/js/environment.js"></script>
<script src="src/js/colonies.js"></script>
<script src="src/js/ecosystem.js"></script>
<script src="src/js/renderer.js"></script>
<script src="src/js/ui.js"></script>
<script src="src/js/events.js"></script>
<script src="src/js/diagnostics.js"></script>
<script src="src/js/main.js"></script>

</body>
</html>
